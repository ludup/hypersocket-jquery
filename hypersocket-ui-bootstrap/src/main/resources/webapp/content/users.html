<div id="contentUsers" class="col-md-12" style="padding-left: 0px">
	<!-- Modal -->
	<div class="modal" id="addUserModal" tabindex="-1" role="dialog"
		aria-labelledby="addUserModalLabel" aria-hidden="true"
		dialog-for="contentUsers">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="myModalLabel"></h4>
				</div>
				<div class="modal-body">

					<div id="userDialogError" class="dialogError"></div>

					<div class="propertyItem form-group">
						<label class="col-md-3 control-label" localize="user.name"></label>
						<div class="propertyValue col-md-9">
							<input type="text" class="form-control propertyInput"
								placeholder="" id="userName" maxlength="" name="name" value="">
							<div>
								<span class="help-block" localize="user.name.info"></span>
							</div>
						</div>
					</div>
					<div id="userProperties" class="tabContent"></div>
					<div id="tabUserGroups" class="tabContent"></div>
					<input type="hidden" name="userId" id="userId">

				</div>
				<div class="modal-footer"></div>
			</div>
		</div>
	</div>
	<div class="modal" id="setPasswordForm" tabindex="-1" role="dialog"
		aria-labelledby="setPasswordModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="myModalLabel"></h4>
				</div>
				<div class="modal-body">

					<form class="form">
						<div id="setPasswordDialogError" class="dialogError"></div>
						<div class="propertyItem form-group">
							<label class="col-md-3 control-label" localize="label.password"></label>
							<div class="propertyValue col-md-9">
								<input type="password" name="password" id="password"
									class="form-control" />
							</div>
						</div>
						<div class="propertyItem form-group">
							<label class="col-md-3 control-label" localize="label.confirmPassword"></label>
							<div class="propertyValue col-md-9">
								<input type="password" name="confirmPassword" id="confirmPassword"
									class="form-control" />
							</div>
						</div>
						<div class="propertyItem form-group">
							<label class="col-md-3 control-label" localize="label.forceChange"></label>
							<div class="propertyValue col-md-9">
								<input type="checkbox" name="forceChange" id="forceChange"
									class="form-control" />
							</div>
						</div>
					</form>

				</div>
				<div class="modal-footer"></div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	$(document).ready(
			function() {
				$('#contentUsers').localize();

				getJSON('groups', null, function(data) {
					$('#tabUserGroups').multipleSelect({
						resourceKey : "groups",
						values : data.resources,
						nameAttr : 'principalName',
						isPropertyInput : false,
						selectedIsObjectList : true
					});
				});

				$('#userProperties').propertyPage({
					url : 'template/user/local',
					showButtons : false,
					useTemplates : true,
					canUpdate : currentMenu.canUpdate,
					additionalTabs : [ {
						id : "tabUserGroups",
						name : getResource("label.groups")
					} ]
				});

				$('#contentUsers').ajaxResourcePage(
						{
							tableUrl : "table/users",
							title : getResource('users.title'),
							icon : 'fa-user',
							resourceUrl : "user",
							fields : [ {
								name : "principalName"
							}, {
								name : "principalDesc"
							} ],
							resourceKey : 'user',
							canCreate : currentMenu.canCreate,
							canUpdate : currentMenu.canUpdate,
							canDelete : currentMenu.canDelete,
							additionalActions : [ {
								resourceKey : "setPassword",
								iconClass : "fa-unlock-alt",
								action : function(resource) {
									$('#setPasswordForm').data('resource',
											resource);
									$('#setPasswordForm').resourceDialog(
											'create');
								},
								enabled : currentMenu.canUpdate
							} ],
							validate : function() {
								if ($('#userName').val() == '') {
									$('#userDialogError').dialogError(
											"error.nameRequired");
									return false;
								}
								return true;
							},
							clearDialog : function() {
								$('#userName').val('');
								$('#userId').val('');
								$('#userProperties').clearProperties();
								$('#tabUserGroups').multipleSelect();
							},
							createResource : function() {
								user = new Object();
								user.id = $('#userId').val();
								user.name = $('#userName').val();

								$('#userProperties').saveProperties(true,
										function(items) {
											user.properties = items;
										});
								user.groups = $('#tabUserGroups')
										.multipleSelectValues();
								return user;
							},
							resourceCreated : function(resource) {

							},
							deleted : function(resource) {

							},
							displayResource : function(resource) {

								$('#userName').val(resource.name);
								$('#userId').val(resource.id);
								$('#userProperties').propertyPage({
									url : 'user/properties/' + resource.id,
									showButtons : false,
									canUpdate : currentMenu.canUpdate,
									additionalTabs : [ {
										id : "tabUserGroups",
										name : getResource("label.groups")
									} ]
								});

								$('#tabUserGroups').multipleSelect({
									selected : resource.groups
								});

								$('#addUserModal').modal('show');

							},
							complete : function() {
								loadComplete();
							}
						});

				$('#setPasswordForm').resourceDialog(
						{
							resourceKey : 'setPassword',
							resourceUrl : 'credentials',
							hasResourceTable : false,
							createResource : function() {

								var resource = $('#setPasswordForm').data(
										'resource');

								creds = new Object();
								creds.principalId = resource.id;
								creds.password = $('#password').val();
								creds.forceChange = $('#forceChange').attr(
										'checked') ? true : false;

								return creds;
							},
							clearDialog : function() {
								$('#password').val('');
								$('#confirmPassword').val('');
								$('#forceChange').val('');
							},
							validate : function() {
								if ($('#password').val() == '') {
									$('#setPasswordDialogError').dialogError(
											"error.passwordEmpty");
									return false;
								}
								if ($('#password').val() != $(
										'#confirmPassword').val()) {
									$('#setPasswordDialogError').dialogError(
											"error.passwordsNotMatched");
									return false;
								}
								return true;
							}
						});
			});
</script>