<div id="contentCertificates">
	<input type="hidden" id="resourceId" name="resourceId" value="" />
	<input type="hidden" id="resourceName" name="resourceName" value="" />
</div>
<div id="additionalActions"></div>


<script type="text/javascript">
	$(document).ready(function() {

				if(!$('#addCertificateForm').length) {
					$('#contentCertificates').append('<div  id="addCertificateForm" dialog-for="contentCertificates"><div id="certificateProperties"></div></div>');
				}
				
				$('#contentCertificates').localize();
				
				getJSON('menus/tableActions/certificateActions', null, function(data) {
					
					var actions = new Array();
					
					if(data.resources.length > 0) {
						$.each(data.resources, function(idx, action) {
							var div = action.resourceKey + 'Div';
							$('#additionalActions').append('<div id="' + div + '"></div>');
							$('#' + div).load(uiPath + '/content/' + action.url + '.html');
							actions.push({
								resourceKey : action.resourceKey,
								iconClass : action.iconClass,
								action : function(resource, callback) {
									if($('#' + action.resourceKey).data('action')) {
										$('#' + action.resourceKey).data('action')(resource, callback);
									}
								},
								enabled : true,
								enableFunction: action.enableFunction,
								displayFunction: action.displayFunction
							});
						});
					 }

					var additionalButtons = new Array();
					
					$('#additionalActions').append('<div id="pemUploadDiv"></div>');
					$('#pemUploadDiv').load(uiPath + '/content/pemUpload.html');
					
					additionalButtons.push({
						resourceKey: 'pemImport',
						icon: 'fa-upload',
						buttonClass: 'btn-success',
						action: function(callback) {
							$('#pemUpload').data('action')(null, function() {
								callback();
							});
						}
					});
					
					$('#additionalActions').append('<div id="pfxUploadDiv"></div>');
					$('#pfxUploadDiv').load(uiPath + '/content/pfxUpload.html');
					
					additionalButtons.push({
						resourceKey: 'pfxImport',
						icon: 'fa-upload',
						buttonClass: 'btn-success',
						action: function(callback) {
							$('#pfxUpload').data('action')(function() {
								callback();
							});
						}
					});
					
					$('#contentCertificates').ajaxResourcePage(
						{
							id : "Certificate",
							tableUrl : "certificates/table",
							title: getResource("certificates.label"),
							icon: 'fa-globe',
							resourceUrl : "certificates/certificate",
							deleteResourcesUrl : "certificates/bulk",
							fields : [ {
								name : "name"
							}, {
								name: "issueDate",
								formatter: function(value, row, index) {
									if(value > 0) {
										return new Date(value).format('dd mmm, yyyy');
									} else {
										return null;
									}
								}
							}, {
								name: "expiryDate",
								formatter: function(value, row, index) {
									if(value > 0) {
										return new Date(value).format('dd mmm, yyyy');
									} else {
										return null;
									}
								}
							}],
							resourceKey : "certificate",
							createButtonText: 'text.createCertificate',
							createButtonIcon: 'fa-certificate',
							resourceView: 'samePage',
							additionalActions: actions,
							additionalButtons: additionalButtons,
							canCreate: currentMenu.canCreate,
							canCopy: false,
							canUpdate: currentMenu.canUpdate,
							canDelete: currentMenu.canDelete,
							checkbox : true,
							confirmationButtonSuccess: 'text.confirmDNS',
							confirmationButtonCancel: 'text.cancelDNS',
							validate : function() {

								if(!$('#certificateProperties').validateProperties()) {
									showError("error.correctValidationErrors");
									return false;
								}
								
								return true;
							},
							confirmed: function(resource, args) {
								resource.properties.push(new PropertyItem('confirmedDNS', 'true'));
								resource.properties.push(new PropertyItem('existingOrder', args[1]));
							},
							clearDialog : function(create) {
								
								$('#resourceId').val('');

							},
							createResource : function() {
								resource = new Object();
								resource.id = $('#resourceId').val();
								
								$('#certificateProperties').saveProperties(true,
										function(items) {
											resource.properties = items;
								});
								
								return resource;
							},
							propertyOptions: {
								propertySelector : '#certificateProperties',
								templateUrl : 'certificates/template/', 
								propertiesUrl: 'certificates/properties/',
								showButtons : false, 
								showAdditionalTabButtons: false,
								maintainButtonState: false,
								i18nNamespace: 'certs',
								canUpdate : currentMenu.canUpdate
							},
							displayResource : function(resource, readOnly) {
								
								$('#resourceId').val(resource.id);
							
							},
							complete : function() {
								loadComplete();
							}
						});
				});

			});
</script>