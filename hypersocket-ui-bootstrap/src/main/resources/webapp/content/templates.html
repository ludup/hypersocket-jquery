
<div id="contentTemplates">
	<div class="modal" id="editTemplateForm" tabindex="-1" role="dialog" dialog-for="contentTemplates">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title"></h4>
				</div>
				<div class="modal-body">
					<div class="propertyItem form-group">
						<label class="col-xs-3 control-label" localize="template.name.label"></label>
						<div class="propertyValue col-xs-9">
							<input type="text" class="form-control propertyInput"
								placeholder="" id="name" maxlength="" name="name" value="">
							<div>
								<span class="help-block" localize="template.name.info"></span>
							</div>
						</div>
					</div>
					<div id="subjectContent" class="propertyItem form-group">
						<label class="col-xs-3 control-label" localize="template.subject.label"></label>
						<div class="propertyValue col-xs-9">
							<input type="text" class="form-control propertyInput"
								placeholder="" id="subject" maxlength="" name="subject" value="">
							<div>
								<span class="help-block" localize="template.subject.info"></span>
							</div>
						</div>
					</div>
					
					<div id="templateProperties"></div>
					<div id="templateContent">
						<div id="wysiwyg">
							<div class="btn-toolbar" data-role="editor-toolbar" data-target="#editor">
						      <div class="btn-group">
						        <a class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="" data-original-title="Font"><i class="fa fa-font"></i><b class="caret"></b></a>
						          <ul class="dropdown-menu">
							          <li><a data-edit="fontName Serif" style="font-family:'Serif'">Serif</a>
							          <li><a data-edit="fontName Sans" style="font-family:'Sans'">Sans</a></li>
							          <li><a data-edit="fontName Arial" style="font-family:'Arial'">Arial</a></li>
							          <li><a data-edit="fontName Arial Black" style="font-family:'Arial Black'">Arial Black</a></li>
							          <li><a data-edit="fontName Courier" style="font-family:'Courier'">Courier</a></li>
							          <li><a data-edit="fontName Courier New" style="font-family:'Courier New'">Courier New</a></li>
							          <li><a data-edit="fontName Comic Sans MS" style="font-family:'Comic Sans MS'">Comic Sans MS</a></li>
							          <li><a data-edit="fontName Helvetica" style="font-family:'Helvetica'">Helvetica</a></li>
							          <li><a data-edit="fontName Impact" style="font-family:'Impact'">Impact</a></li>
							          <li><a data-edit="fontName Lucida Grande" style="font-family:'Lucida Grande'">Lucida Grande</a></li>
							          <li><a data-edit="fontName Lucida Sans" style="font-family:'Lucida Sans'">Lucida Sans</a></li>
							          <li><a data-edit="fontName Tahoma" style="font-family:'Tahoma'">Tahoma</a></li>
							          <li><a data-edit="fontName Times" style="font-family:'Times'">Times</a></li>
							          <li><a data-edit="fontName Times New Roman" style="font-family:'Times New Roman'">Times New Roman</a></li>
							          <li><a data-edit="fontName Verdana" style="font-family:'Verdana'">Verdana</a></li>
						          </ul>
						        </div>
						      <div class="btn-group">
						        <a class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="" data-original-title="Font Size"><i class="fa fa-text-height"></i>&nbsp;<b class="caret"></b></a>
						          <ul class="dropdown-menu">
						          <li><a data-edit="fontSize 5"><font size="5" localize="font.huge"></font></a></li>
						          <li><a data-edit="fontSize 3"><font size="3" localize="font.normal"></font></a></li>
						          <li><a data-edit="fontSize 1"><font size="1" localize="font.smal"></font></a></li>
						          </ul>
						      </div>
						      <div class="btn-group">
						        <a class="btn btn-default" data-edit="bold" title="" data-original-title="Bold (Ctrl/Cmd+B)"><i class="fa fa-bold"></i></a>
						        <a class="btn btn-default" data-edit="italic" title="" data-original-title="Italic (Ctrl/Cmd+I)"><i class="fa fa-italic"></i></a>
						        <a class="btn btn-default" data-edit="strikethrough" title="" data-original-title="Strikethrough"><i class="fa fa-strikethrough"></i></a>
						        <a class="btn btn-default" data-edit="underline" title="" data-original-title="Underline (Ctrl/Cmd+U)"><i class="fa fa-underline"></i></a>
						      </div>
						      <div class="btn-group">
						        <a class="btn btn-default" data-edit="insertunorderedlist" title="" data-original-title="Bullet list"><i class="fa fa-list-ul"></i></a>
						        <a class="btn btn-default" data-edit="insertorderedlist" title="" data-original-title="Number list"><i class="fa fa-list-ol"></i></a>
						        <a class="btn btn-default" data-edit="outdent" title="" data-original-title="Reduce indent (Shift+Tab)"><i class="fa fa-outdent"></i></a>
						        <a class="btn btn-default" data-edit="indent" title="" data-original-title="Indent (Tab)"><i class="fa fa-indent"></i></a>
						      </div>
						      <div class="btn-group">
						        <a class="btn btn-default" data-edit="justifyleft" title="" data-original-title="Align Left (Ctrl/Cmd+L)"><i class="fa fa-align-left"></i></a>
						        <a class="btn btn-default" data-edit="justifycenter" title="" data-original-title="Center (Ctrl/Cmd+E)"><i class="fa fa-align-center"></i></a>
						        <a class="btn btn-default" data-edit="justifyright" title="" data-original-title="Align Right (Ctrl/Cmd+R)"><i class="fa fa-align-right"></i></a>
						        <a class="btn btn-default" data-edit="justifyfull" title="" data-original-title="Justify (Ctrl/Cmd+J)"><i class="fa fa-align-justify"></i></a>
						      </div>
						      <div class="btn-group">
								  <a class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="" data-original-title="Hyperlink"><i class="fa fa-link"></i></a>
								    <div class="dropdown-menu input-append">
									    <input class="span2" placeholder="URL" type="text" data-edit="createLink">
									    <button class="btn btn-default" type="button">Add</button>
						        </div>
						        <a class="btn btn-default" data-edit="unlink" title="" data-original-title="Remove Hyperlink"><i class="fa fa-unlink"></i></a>
						      </div>
						      
						      <div class="btn-group">
						        <a class="btn btn-default" title="" id="pictureBtn" data-original-title="Insert picture (or just drag &amp; drop)"><i class="fa fa-image"></i></a>
						        <input type="file" data-role="magic-overlay" data-target="#pictureBtn" data-edit="insertImage" style="opacity: 0; position: absolute; top: 0px; left: 0px; width: 41px; height: 30px;">
						      </div>
						      <div class="btn-group">
						        <a class="btn btn-default" data-edit="undo" title="" data-original-title="Undo (Ctrl/Cmd+Z)"><i class="fa fa-undo"></i></a>
						        <a class="btn btn-default" data-edit="redo" title="" data-original-title="Redo (Ctrl/Cmd+Y)"><i class="fa fa-repeat"></i></a>
						      </div>
						      <input type="text" data-edit="inserttext" id="voiceBtn" x-webkit-speech="" style="position: absolute; top: 280px; left: 1287px;">
						    </div>
						    <div id="editor" contenteditable="true" style="overflow: scroll; height:300px">
						    </div>
					    </div>
					    <div id="code"></div>
					</div>
				</div>
				<div class="modal-footer"></div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">


	$(document).ready(function() {

		//$('#templateContent').hide();
		$('#contentTemplates').localize();
		$('#templateContent').localize();
		

		$('#editor').wysiwyg({
            hotKeys: {
                'ctrl+b meta+b': 'bold',
                'ctrl+i meta+i': 'italic',
                'ctrl+u meta+u': 'underline',
                'ctrl+z meta+z': 'undo',
                'ctrl+y meta+y meta+shift+z': 'redo'
            },
            dragAndDropImages: true
        });
		
		$('.dropdown-menu input, .dropdown-menu label').click(function(e) {
	        e.stopPropagation();
	    });
		
		var myCodeMirror = CodeMirror(document.getElementById("code"), {
			  value: "",
			  mode:  "css"
		});
		
		$('#templateProperties').propertyPage({
			url : 'templates/properties',
			showButtons : false,
			useTemplates : true,
			canUpdate : currentMenu.canUpdate,
			additionalTabs : [ {
				id : "templateContent",
				name : getResource("template.label")
			}]
		});
		
		
		$('#contentTemplates').ajaxResourcePage(
				{
				title: getResource('templates.title'),
				icon: 'fa-file-code-o',
				tableUrl : "templates/table/" + $(document).data('templateType'),
				resourceUrl : "templates/template",
				disableDecoration: true,
				fields : [ { name: "name", isResourceKey: true }],
				resourceKey : 'template',
				canCreate: false,
				canUpdate: currentMenu.canUpdate,
				canDelete: false,
				validate : function() {
					if ($('#name').val() == '') {
						showError(true, getResource("error.nameRequired"));
						return false;
					}
					return true;
				},
				clearDialog : function() {
					$('#name').val('');
					$('#subject').val('');
					$('#editor').html('');
					myCodeMirror.setValue('');
				},
				createResource : function() {
					var resource = $('#templateContent').data('resource');
					resource.subject = $('#subject').val();
					if(resource.editor=='CODE_CSS') {
						resource.template = myCodeMirror.getValue();
					} else {
						resource.template = $('#editor').cleanHtml();
					}
					return resource;
				},
				displayResource : function(resource) {
					$('#templateContent').data('resource', resource);
					if(resource.nameIsResourceKey) {
						$('#name').val(getResource("template." + resource.name + ".label"));
						$('#name').attr('disabled', true);
					} else {
						$('#name').val(resource.name);
						$('#name').attr('disabled', false);
					}
					
					if(resource.hasSubject) {
						$('#subjectContent').show();
						$('#subject').val(resource.subject);
					} else {	
						$('#subjectContent').hide();
						$('#subject').val('');
					}
					
					if(resource.editor=='CODE_CSS') {
						myCodeMirror.setValue(resource.template);
						$('#wysiwyg').hide();
						$('#code').show();
					} else {
						$('#editor').html(resource.template);
						$('#wysiwyg').show();
						$('#code').hide();
					}
					
				},
				complete: function() {
					loadComplete();
				}
			});
	});
	</script>